# Case: Persistent BSOD 0xc000021a on Windows 11

## üìù Summary
Troubleshooting and resolving a persistent `0xc000021a` Blue Screen of Death (BSOD) on a Windows 11 system.  
The system would not boot from the NVMe SSD or USB installation media with Intel VMD enabled.  
Final resolution involved disabling VMD, repairing boot files, and performing a clean Windows installation.

---

## ‚öôÔ∏è Environment
- **Motherboard:** MSI B760 Gaming Plus WiFi (MS-7D98)  
- **CPU:** Intel Core i9-12900K (12th Gen)  
- **Memory:** 32GB DDR4 @ 4800MHz  
- **Storage:** Crucial P3 Plus NVMe SSD, 2TB (CT2000P3PSSD8)  
- **BIOS Mode:** CSM/UEFI  
- **BIOS Version:** E7D98IMS.H60 (Build Date: 2024-01-10)  
- **BIOS Temps:** CPU ~28¬∞C, Motherboard ~32¬∞C  

---

## üîç Symptoms

**With VMD (Volume Management Device) enabled:**
- NVMe SSD not shown in standard BIOS storage list
- SSD visible only in Intel Rapid Storage Technology (RST) as ‚ÄúNon-RAID Physical Disk‚Äù
- Windows boot fails with 0xc000021a BSOD

**With VMD disabled:**
- NVMe SSD appears in BIOS storage list normally
- Boot priority set to USB only, but system still loads BSOD instead of USB installer

**Additional Notes:**
- USB Windows 11 installer confirmed working on another system
- Resetting BIOS to optimized defaults did not resolve issue

---

## üéØ Goal
- Eliminate 0xc000021a BSOD
- Boot successfully from USB installation media
- Configure BIOS so NVMe is recognized without VMD boot issues

---

## üõ†Ô∏è Steps Taken

### 1. BIOS Configuration
- Loaded **Optimized Defaults**
- Boot Mode: **UEFI only** (CSM disabled)
- Disabled **Intel VMD Controller**  
  *(Settings ‚Üí Advanced ‚Üí Integrated Peripherals ‚Üí RAID Configuration)*
- Disabled **Secure Boot** temporarily
- Saved & exited BIOS

---

### 2. Recreated Installation Media
- Used Microsoft **Media Creation Tool** for Windows 11 USB installer
- Partition scheme: **GPT**
- File system: **FAT32** for UEFI compatibility

---

### 3. Forced USB Boot
- Plugged USB into **rear-panel USB 2.0 port**
- Used **F11** at boot for MSI Boot Menu
- Selected **UEFI: <USB name>**
- Confirmed Windows Setup loaded successfully when NVMe SSD was physically removed (diagnostic isolation step)

---

### 4. Repair via WinRE (Command Prompt)

**Checked volumes:**
diskpart
list vol
exit
Reverted pending updates:

dism /image:D:\ /cleanup-image /revertpendingactions
Ran offline SFC:


sfc /scannow /offbootdir=D:\ /offwindir=D:\Windows
Rebuilt boot files:


diskpart
sel disk 0
list part
sel part <EFI Partition #>
assign letter=S
exit
bcdboot D:\Windows /s S: /f UEFI
5. Clean Install (When Repair Failed)
Booted from UEFI USB

Deleted all partitions on NVMe

Allowed Windows Setup to create new GPT partitions

Installed Windows 11 with VMD disabled

6. Post-Install
Updated BIOS to latest version via MSI M-Flash

Re-enabled Secure Boot

Installed chipset and storage drivers from MSI support page

üéØ Root Cause
The Intel VMD setting in BIOS caused the NVMe drive to appear only in Intel RST, preventing proper boot and interfering with USB boot priority.
With VMD enabled, Windows was unable to load from the NVMe or installation media.

‚úÖ Solution
Disabled Intel VMD in BIOS

Performed clean install of Windows 11 with UEFI boot mode

Updated BIOS and installed correct storage drivers

üí° Lessons Learned
Intel VMD can block OS boot when NVMe drives are not in RAID mode

FAT32 + GPT format ensures maximum UEFI boot compatibility

Isolating hardware (removing NVMe) confirmed USB installation media was functional

BIOS settings (VMD, Secure Boot, Boot Mode) are critical in storage troubleshooting
